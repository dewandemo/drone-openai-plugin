kind: pipeline
type: docker
name: openai-example

steps:
  # Example 1: Simple text prompt
  - name: analyze-code
    image: yourdockerhub/drone-openai-plugin:latest
    settings:
      api_key:
        from_secret: openai_api_key
      model: gpt-4o-mini
      prompt: "Analyze the following code and suggest improvements"
      file: src/main.py
      output_file: analysis.txt
      temperature: 0.7
      max_tokens: 1500

  # Example 2: Image analysis
  - name: analyze-image
    image: yourdockerhub/drone-openai-plugin:latest
    settings:
      api_key:
        from_secret: openai_api_key
      model: gpt-4o
      prompt: "Describe this architecture diagram and identify potential issues"
      file: docs/architecture.png
      output_file: image-analysis.md
      
  # Example 3: Generate documentation
  - name: generate-docs
    image: yourdockerhub/drone-openai-plugin:latest
    settings:
      api_key:
        from_secret: openai_api_key
      model: gpt-4o-mini
      system_prompt: "You are a technical documentation expert"
      prompt: "Generate comprehensive API documentation based on this OpenAPI spec"
      file: api/openapi.yaml
      output_file: docs/api-documentation.md
      max_tokens: 4000

  # Example 4: Code review
  - name: code-review
    image: yourdockerhub/drone-openai-plugin:latest
    settings:
      api_key:
        from_secret: openai_api_key
      model: gpt-4o-mini
      system_prompt: "You are a senior software engineer performing a code review"
      prompt: "Review this code for security vulnerabilities, performance issues, and best practices"
      file: src/auth.go
      temperature: 0.3
      output_file: review-results.md

# Trigger configuration
trigger:
  branch:
    - main
    - develop
  event:
    - push
    - pull_request